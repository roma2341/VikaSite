<html lang="en">
<head>
<meta charset="utf-8" />
<!-- This file has been downloaded from Bootsnipp.com. Enjoy! -->
<title>Textview</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="js/jquery.js"></script>
<script src="js/bootstrap.min.js" type="text/javascript"></script>
<script src="js/mustache.min.js" type="text/javascript"></script>
<link rel="stylesheet" href="css/bootstrap.css" />
<style type="text/css">
h1.page-header {
	margin-top: -5px;
}

div {
	font-size: 20px
}

.sidebar {
	padding-left: 0;
}

.main-container {
	background: #FFF;
	padding-top: 15px;
	margin-top: -20px;
}

.footer {
	width: 100%;
}
</style>
<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
<script
	src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
</head>
<body>

	<div class="container-fluid main-container">
		<div th:utext="${author.login}"></div>
		<div th:utext="${post.getDataHTML()}">some text</div>
	</div>
	
	<div>
	<input type="text" id="comment_message">
	<button type="button" class="btn btn-default" id="submit_comment" 
	onclick="onClickAddComment()">Comment</button>
	</div>
	<div id="comments">
	
	</div>

<script id="sample_template" type="text/template">
<div style="color:red">
{{text}}
</div>
</script>


<script th:inline="javascript" type="text/javascript" >
//<![CDATA[
var post_id = /*[[${post.id}]]*/'value';
//]]>
	function onClickAddComment(){
		var json={
		"post":{
			"id":""+post_id
		},
		"text":$("#comment_message").val()
		};
		var jsonString = JSON.stringify(json);
   		 $.ajax({
   		    type: 'POST',
   		    url: '/comment',
   		 contentType: "application/json; charset=utf-8",
   		    cache: false,
   		 data: jsonString,
   		processData:false,
   		    error: function(){
   		    	alert('error commenting');
   		    },
   		 success:function(){
   			console.log("success sended comments");
   		 }
   		    });   	    	
	}
	/*function onClickDeleteUserButton(id){
		 
	    	    	
	   		 $.ajax({
	   		    type: 'GET',
	   		    url: '/removeuser?user_id='+id,
	   		    cache: false,
	   		    error: function(){
	   		    	alert('error deleting permission');
	   		    }
	   		    });  
	    	    	
	}*/
    $(document).ready(function () {
    	
    		 var template = $('#sample_template').html();
    		 var interval = 1000;   //number of mils between each call
    		 function addComment(comment){
    			 $('#comments').append((Mustache.to_html(template,comment)));
    	     }
    		 function clearComments(){
    			 $('#comments').empty();
    		 }
    		 var refresh = function() {
    		 $.ajax({
    type: 'POST',
    contentType: "application/json; charset=utf-8",
    url: '/json/get_comments',
    cache: false,
    data: post_id,
    dataType: "json",
    processData:false,
    success:function(comments){
    	console.log("success received comments");
    	clearComments();
    	//$('#comments').append(emptyTable);
    	$.each(comments,function(i,comment){
    		addComment(comment);
    	});
    	 setTimeout(function() {
             refresh();
    	 },interval);
    },
    error: function(data){
    	alert('error loading users'+data);
    }
    });
    		 };
    		 refresh();
    		 });
    		 
     
     </script>
     
</body>


</html>
